name: "Markdown to Notion"
description: "Syncs Markdown files to Notion pages and updates an index block."
inputs:
  notion_token:
    description: "Notion Integration Secret"
    required: true

  docs_folder:
    description: "Path to folder containing markdown files"
    required: true

  index_block_id:
    description: "Notion block ID or block URL for the index list container"
    required: false

  parent_page_id:
    description: "Notion page ID where files will be created when index_block_id is not provided"
    required: false

  folder_strategy:
    description: "How to represent subfolders: 'subpages' creates nested pages, 'title_prefix' prefixes titles with folder path"
    required: false
    default: "subpages"

  push_failure_mode:
    description: "Behavior when git push fails: 'fail' (default) or 'warn'"
    required: false
    default: "fail"

  github_token:
    description: "GitHub token used to commit notion_page_id updates"
    required: true

runs:
  using: "composite"
  steps:
    - name: Install dependencies
      run: npm install
      shell: bash
      working-directory: ${{ github.action_path }}

    - name: Sync markdown to Notion
      run: npx tsx src/main.ts
      shell: bash
      working-directory: ${{ github.action_path }}
      env:
        INPUT_NOTION_TOKEN: ${{ inputs.notion_token }}
        INPUT_DOCS_FOLDER: ${{ inputs.docs_folder }}
        INPUT_INDEX_BLOCK_ID: ${{ inputs.index_block_id }}
        INPUT_PARENT_PAGE_ID: ${{ inputs.parent_page_id }}
        INPUT_FOLDER_STRATEGY: ${{ inputs.folder_strategy }}
        INPUT_PUSH_FAILURE_MODE: ${{ inputs.push_failure_mode }}
        INPUT_GITHUB_TOKEN: ${{ inputs.github_token }}

        NOTION_TOKEN: ${{ inputs.notion_token }}
        DOCS_FOLDER: ${{ inputs.docs_folder }}
        INDEX_BLOCK_ID: ${{ inputs.index_block_id }}
        PARENT_PAGE_ID: ${{ inputs.parent_page_id }}
        FOLDER_STRATEGY: ${{ inputs.folder_strategy }}
        PUSH_FAILURE_MODE: ${{ inputs.push_failure_mode }}
        GITHUB_TOKEN: ${{ inputs.github_token }}
